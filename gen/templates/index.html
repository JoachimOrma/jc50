<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> JC50 | Registration </title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
    </style>
</head>
<body>
   <div class="container-xxl hero-header">

    <section id="logo">
        <div class="d-flex justify-content-center align-items-center">
            <img src="/static/img/IV.jpg" alt="" width="320" style="cursor: pointer;">
        </div>
    </section>

    <!-- Registration Form Start -->
    <section class="hidden" style="padding: 4.5vh 0;" id="form-container">
        <div class="row justify-content-center align-items-center">
            <div class="col-md-5 col-11 p-0 form-wrapper">
                <div class="p-2 text-center form-title">
                    <h3> JC50 EVENT REGISTRATION </h3>
                </div>
                <form method="post" class="p-4">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <input type="text" name="first_name" id="first_name" class="form-control" placeholder="First Name" />
                                <label for="first_name">First Name</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <input type="text" name="last_name" id="last_name" class="form-control" placeholder="Last Name" />
                                <label for="last_name">Last Name</label>
                            </div>
                        </div>   
                        <div class="col-12">
                            <div class="form-floating mb-3">
                                <input type="text" name="email" id="email" class="form-control" placeholder="Email" />
                                <label for="email">Email</label>
                            </div>
                        </div>                 
                        <div class="col-md-12">
                            <div class="form-floating mb-3">
                                <input type="text" name="phone" id="phone" class="form-control" placeholder="Phone" />
                                <label for="rank">Phone</label>
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-dark col-12" id="submitBtn">Submit </button>
                        </div>
                    </div>  
                </form>
            </div>
        </div>
    </section>
    <!-- Registration Form End -->

   </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    <script>
        $(document).ready(function(){
            const button = document.querySelector('#logo img');
            const formContainer = document.getElementById('form-container');

            button.addEventListener('click', (event) => {
                // Add animation class to the button
                button.classList.add('animate__animated', 'animate__flipOutX');

                // Wait for the button animation to finish before showing the form
                button.addEventListener('animationend', () => {
                    button.classList.add('hidden');
                    formContainer.classList.remove('hidden'); // Show the form
                    formContainer.offsetWidth; // Trigger reflow for animation
                    formContainer.classList.add('animate__animated', 'animate__flipInX'); // Animate form
                }, { once: true }); // Ensures this runs only once
            });
            
            $('#submitBtn').click(function(e){
                e.preventDefault();
                $.ajax({
                    url: "{% url 'home' %}",
                    type: 'POST',
                    data: {
                        "first_name": $('#first_name').val(),
                        "last_name": $('#last_name').val(),
                        "email": $('#email').val(),
                        "phone": $('#phone').val(),
                        "csrfmiddlewaretoken": "{{ csrf_token }}",
                    },
                    beforeSend: function(response){
                        $('#submitBtn').html(`
                            <div class='d-flex align-items-center justify-content-center'>
                                <span class='spinner-border text-light aria-hidden='true'></span>
                                <span role='status' class="sr-only">processing...</span>
                            </div>
                        `)
                    },
                    success: function(response){
                        if (response.status == 200){
                            swal({
                                text: "Registration was successful.",
                                icon: 'success',
                                timer: 1500,
                                buttons: false,
                            })
                            setTimeout(() => {
                                window.location.href = "{% url 'home' %}";
                            }, 2000);
                        } else if (response.status == 100){
                            swal({
                                text: "Eamil address is already registered.",
                                icon: 'error',
                                timer: 2000,
                                buttons: false,
                            })
                        } else if (response.status == 400) {
                            swal({
                                text: "All feilds are required.",
                                icon: 'error',
                                timer: 2000,
                                buttons: false,
                            })
                        }
                        $('#submitBtn').text("Submit");
                    },
                    error: function(error){
                        swal({
                            text: "Soomething went wrong, please try again later.",
                            icon: 'error',
                            timer: 2000,
                            buttons: false,
                        })
                    }
                })
            })
        });
   </script>
</body>
</html>
